# diecasting-project

## 🏭 프로젝트 제목

> **다이캐스팅 공정 데이터 기반 불량 예측·모니터링**

---

## 📌 목차

1. [프로젝트 개요](#-프로젝트-개요)
2. [주요 데이터 컬럼 소개](#-주요-데이터-컬럼-소개)
3. [데이터 분석 및 전처리 과정](#-데이터-분석-및-전처리-과정)
4. [주요 인사이트](#-주요-인사이트)
5. [결론](#-결론)
6. [사용 기술](#-사용-기술)
7. [프로젝트 구조](#-프로젝트-구조)
8. [팀원 소개](#-팀원-소개)

---

## 📝 프로젝트 개요

- **목적**: 레오캐스팅(다이캐스팅) 공정의 센서·설비 데이터를 활용해 **품질 불량(passorfail=1) 예측 및 분석** 서비스 구축
- **배경**:
  - 제조 현장에서 불량품이 발생하면, **어느 공정 단계에서 문제가 생겼는지 파악**하는 것이 매우 중요함
  - 불량 원인을 빠르게 찾아 해결하지 못하면 **생산 효율 저하\*와 **비용 증가\*\*로 이어짐
  - 레오캐스팅처럼 복잡한 공정에서는 용탕 온도, 압력, 속도 등 수십 개의 변수가 상호작용하기 때문에, 육안이나 경험만으로는 원인을 찾기 어려움
  - 중소 제조 현장에서는 변수 관리가 체계화되어 있지 않아 경험·수작업 의존이 크고, 불량(기공·수축·충전 부족 등)의 원인-데이터 매핑이 미흡함.
  - 공장 환경(온도·습도)·계절성 등 외생 요인이 품질 변동을 키워 장기 데이터 축적과 추세 분석이 필요함.
  - 따라서 공정 데이터를 **표준화·정제**하고, **머신러닝 예측** + **XAI**로 불량 사전 감지와 원인 해석을 제공하는 데이터 기반 운영 체계가 요구됨.
- **기대효과**:

  - **불량률 저감**(저온·워밍업 구간 관리, 임계치 알림)
  - **금형(mold_code)별 최적 조건** 도출 및 재현
  - **설명 가능한 AI(XAI)** 로 원인 가시화 → 현장 의사결정 지원

---

## 📂 주요 데이터 컬럼 소개

| 공정 단계                 | 주요 컬럼                                                                                                | Shiny UI 입력 요소                                                                   | 설명 / 활용 목적                                         |
| ------------------------- | -------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ | -------------------------------------------------------- |
| **1) 용탕 준비 및 가열**  | `molten_temp`, `molten_volume`                                                                           | `ui.input_slider("molten_temp")` <br> `ui.input_slider("molten_volume")`             | 용탕 온도와 부피 관리 → 저온/부족 용탕 시 불량률 ↑       |
| **2) 반고체 슬러리 제조** | `sleeve_temperature`, `EMS_operation_time`                                                               | `ui.input_slider("sleeve_temperature")` <br> `ui.input_select("EMS_operation_time")` | 슬리브·EMS 작동 시간 → 초기 워밍업 및 불량 영향          |
| **3) 사출 & 금형 충전**   | `cast_pressure`, `low_section_speed`, `high_section_speed`, `physical_strength`, `biscuit_thickness`     | `ui.input_slider` 다수                                                               | 압력·속도·형체력 등 충전 조건 → 기공/수축 불량 주요 요인 |
| **4) 응고**               | `upper_mold_temp1`, `upper_mold_temp2`, `lower_mold_temp1`, `lower_mold_temp2`, `coolant_temp`           | `ui.input_slider` 다수                                                               | 금형·냉각수 온도 → 응고 균일성 및 수축 불량              |
| **기타 (전체 과정)**      | `mold_code`, `working`, `count`, `facility_operation_cycleTime`, `production_cycletime`, `tryshot_check` | `ui.input_select`, `ui.input_numeric`, `ui.input_slider`, `ui.input_checkbox`        | 금형 코드·작업 상태·사이클 타임 → 리셋·트라이샷 반영     |

---

## 🔍 데이터 분석 및 전처리 과정

### 0. 데이터 요약

- 전체 데이터: **73,612행 × 다변수 센서/메타 정보**
- 결측치 포함 열: 다수 확인됨
- 수치형 변수와 범주형 변수 분리 (예: 온도·속도·압력 vs 금형코드·작업여부 등)
- 타깃(`passorfail`) 불균형: 약 **4.45% 불량**

### 1. 변수 선택

- **가용 변수**
  - 용탕 온도(`molten_temp`), 슬리브 온도(`sleeve_temperature`), EMS 작동시간(`EMS_operation_time`)
  - 주조 압력(`cast_pressure`), 저속/고속 구간 속도(`low/high_section_speed`), 형체력(`physical_strength`)
  - 금형 온도(`upper/lower_mold_temp`), 냉각수 온도(`Coolant_temperature`)
  - 생산 순번(`count`), 가동여부(`working`), 시험샷(`tryshot_signal`)
- **제외 변수**
  - 상수값: `upper_mold_temp3`, `lower_mold_temp3`
  - 동일값: `line`, `name`, `mold_name`, `emergency_stop`
  - 중복 기록: `date`, `time`, `registration_time`
  - 불필요 식별자: `id`
  - 불안정 변수: `heating_furnance` (A/B/nan 혼재, 대체 효과 없음)

### 2. 데이터 정제

- **중복 제거**: 동일 제품 중복 기록 10건 제거
- **행 제거**: 스파크 의심·다수 결측 포함 행 8건 제거 (예: 행번호 42632, 19327 등)
- **데이터 타입 변경**:
  - `mold_code` → 범주형
  - `EMS_operation_time` → 범주형
- **결측치 처리**:
  - `tryshot_signal`: NaN → 정상 라벨 `"A"`
  - `molten_volume`: NaN → `-1` (보간 불가 처리)
  - `molten_temp`: NaN → 보간값(709℃)으로 대체
- **이상치 처리**:
  - `production_cycletime=0` → `facility_cycletime` 값으로 대체
  - `molten_temp ≤100` → 앞뒤 값 보간
  - `sleeve_temperature=1449` → 앞뒤 값 보간
  - `Coolant_temperature=1449` → 정상값 35로 대체
  - `physical_strength=0` → 금형 평균값으로 대체

### 3. 모델링 준비

- 데이터 분리: 8:2 비율, **금형코드 + 불량 라벨 기준 층화 샘플링**
- 불균형 처리: 불량 데이터 오버샘플링 (약 4배), SMOTENC 적용
- 수치형 변수: RobustScaler 적용
- 범주형 변수: One-Hot Encoding 적용
- 금형코드별 개별 모델 구축 → 구조적 차이에 따른 결함 양상 반영

### 4. 모델링 결과

- **성능 지표**
  - RandomForest: 평균 **Accuracy 0.9930 / Recall 0.9663 / F2 0.9504**
  - LightGBM, XGBoost도 유사 성능 확보
  - Logistic Regression은 Accuracy 높지만 Recall 상대적으로 낮음 → 불량 검출에는 부적합
- **금형코드별 결과**
  - `8412`, `8722`: RF 모델 Recall 높음 (불량 검출 우수)
  - `8917`: 이상치 영향 커서 모델 성능 편차 존재 → 추가 보정 필요
  - `8600`: 전반적으로 안정적

### 5. 설명 가능한 AI (XAI)

- SHAP 기반 중요 변수 도출:
  - `cast_pressure`, `molten_temp`, `sleeve_temperature`, `physical_strength`
- Rule 기반 임계치 설정: 상/하한 구간 벗어날 경우 위험 경고
- SHAP + Rule 결합 신호 → 강한 원인 후보 / 관찰 필요 / 정상 으로 등급화

### 6. 변수 조정 가이드

- **1단계 (Rule 보정)**: 임계값 위반 변수는 즉시 보정
- **2단계 (SHAP 보정)**: 기여도 높은 변수부터 순차적 조정
- **목표**: 불량 확률을 **30% 미만**으로 낮추는 방향

---

## 💡 주요 인사이트

- **리셋 직후 워밍업 구간 = 불량 취약**

  - `count` 리셋 후 초반 샷에서 슬리브/냉각수 온도 변동이 크게 나타남
  - 초기 구간 불량률이 다른 구간 대비 유의하게 높음

- **저온 위험대 존재**

  - 슬리브 온도, 용탕 온도 등이 일정 임계값 이하로 떨어질 경우 불량 확률 급상승
  - 안정 온도 범위를 벗어나면 기공·수축 결함이 동반됨

- **금형별 특성 차이**

  - `8600`: 전반적으로 안정적이며 불량률 낮음
  - `8917`: 센서 이상치(0값, 급스파이크) 및 변동성 큼 → 불량 다발, 장비 점검 필요
  - `8722 / 8412 / 8573`: 리셋 직후·저온 구간에서 불량 집중 발생

- **형체력 안정 구간 확인**
  - 약 **690~700 bar** 유지 시 품질 안정
  - **682 bar 이하 급락 시 불량 증가** → 설비 제어 상시 모니터링 필요

---

## 🏛 결론

이번 프로젝트의 성과

- **공정을 단계별로 나누어 불량 발생 지점과 주요 원인 변수를 구체적으로 규명**

### 1. 핵심 발견

- 불량 발생은 **저온 구간**과 **리셋 직후 초기샷**에서 집중적으로 나타남
- 금형별 특성이 뚜렷해, **금형별 모델 분리와 조건 최적화**가 필요
- 공정 변수(온도·형체력 등) 모니터링과 **임계치 기반 경고 시스템**을 통해  
  사전 대응 체계 구축 가능

### 2. 공정별 주요 요인

- **용탕 준비·가열**: 용탕 온도, 용탕 부피
- **슬러리 제조**: 슬리브 온도, EMS 작동시간
- **사출·충전**: 주조 압력, 구간 속도, 형체력, 비스킷 두께
- **응고**: 금형 온도 불균일, 냉각수 온도
- **전체 과정**: 리셋 구간(`count`), 시험샷(`tryshot_signal`), 금형코드(`mold_code`)

### 3. 시사점

- 단순 평균 관리가 아닌 **공정별 취약 구간 중심 관리 전략** 필요
- 금형·공정별 조건 최적화를 통해 **재현 가능한 양품 레시피** 구축 가능
- 센서 이상치 검출·보정 로직이 불량 방지에 필수

### 4. 기대 효과

- **불량률 저감**: 저온·리셋·압력 급락 구간 관리 시 수 % 개선 가능
- **생산성 향상**: 초기 워밍업 시간 단축 → 가동률 증가
- **비용 절감**: 재작업 감소로 원재료·에너지 절약
- **현장 활용성**: SHAP 기반 원인 가시화 → 작업자 교육 및 실시간 대응 지원

---

## 🛠 사용 기술

**언어**

- Python 3.11

**라이브러리 & 프레임워크**

- 데이터 처리: `pandas`, `numpy`
- 분석/알고리즘: `scikit-learn`, `scipy`, `statsmodels`, `imbalanced-learn`, `xgboost`, `shap`
- 시각화: `matplotlib`, `seaborn`, `plotly`, `shapely`
- 웹/대시보드: **Shiny for Python(Core)** (`shiny`, `shinywidgets`)
- 기타 유틸: `joblib`, `pyyaml`, `tqdm`

**환경**

- Jupyter Notebook, VSCode
- Git/GitHub

---

## 📁 프로젝트 구조

```plaintext
📦 diecasting-project
 ┣ 📂 data              # 원본 및 전처리 데이터
 ┣ 📂 models            # 학습한 모델 저장
 ┣ 📂 modules           # Shiny 앱과 분석·시각화 로직을 연결하는 모듈
 ┣ 📂 prep              # 데이터 전처리 스크립트
 ┣ 📂 viz               # 분석 결과 시각화 코드 및 함수
 ┣ 📂 www               # 정적 파일 (CSS, JS 등 스타일 리소스)
 ┣ 📜 app.py            # Shiny 웹앱 실행 메인 파일
 ┣ 📜 shared.py         # 웹앱 공통 모듈 (데이터 로딩, 전역 변수 등)
 ┣ 📜 README.md         # 프로젝트 설명 문서
 ┣ 📜 requirements.txt  # pip 환경 설정
 ┗ 📜 environment.yml   # conda 환경 설정
```

---

## 👥 팀원 소개

| 이름   | 주요 역할                          | 담당 업무                                                                                           |
| ------ | ---------------------------------- | --------------------------------------------------------------------------------------------------- |
| 김선준 | 데이터 전처리 / 보고서 작성 / 발표 | 결측치·이상치 처리 로직 설계, 변수 정제 및 임계치 설정 / 데이터 전처리 보고서 작성 / 최종 발표 주도 |
| 이우영 | 데이터 전처리 / 보고서 작성        | 원본 데이터 클리닝, 이상치 검출 및 보정, 불량 구간 기준 도출 / 데이터 분석 보고서 작성              |
| 임지원 | 프로젝트 매니저 (PM) / 모델링      | 프로젝트 일정 관리, 역할 분담 및 조율 / 발표 자료 제작 총괄 / RandomForest 최적화                   |
| 장승규 | 모델링                             | 머신러닝 모델 학습·튜닝, 성능 평가, 모델 비교 실험 / XGBoost 최적화                                 |
| 황연주 | Tech Leader / 대시보드 / 발표      | GitHub 형상 관리 / Shiny Core 구현, UI·UX 설계 및 시각화 통합 / 최종 발표 주도                      |
| 안형엽 | 대시보드                           | 데이터 탐색(EDA) 탭 개발, 시각화 요소 구현, 대시보드 기능 보완                                      |

> 모든 팀원이 **데이터 탐색(EDA)** 과정에 참여했으며, 이후 전처리–모델링–대시보드–발표로 이어지는 전체 파이프라인을 PM(임지원)과 Tech Leader(황연주)를 중심으로 협업하여 프로젝트를 완성했습니다.
